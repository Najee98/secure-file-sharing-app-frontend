<app-navbar></app-navbar>

<div class="shares-container">
  <div class="header">
    <h1>
      <mat-icon>share</mat-icon>
      My Shared Links
    </h1>
    <p class="subtitle">Manage all your shared files and folders</p>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && shares.length === 0" class="empty-state">
    <mat-icon class="empty-icon">link_off</mat-icon>
    <h2>No shared links</h2>
    <p>Share files or folders from your dashboard to see them here</p>
  </div>

  <!-- Shares Table -->
  <div *ngIf="!isLoading && shares.length > 0" class="table-container">
    <table mat-table [dataSource]="shares" class="shares-table">

      <!-- Item Name Column -->
      <ng-container matColumnDef="itemName">
        <th mat-header-cell *matHeaderCellDef>Item</th>
        <td mat-cell *matCellDef="let share">
          <div class="item-cell">
            <mat-icon>{{ getTypeIcon(share.itemType) }}</mat-icon>
            <span>{{ share.itemName }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Item Type Column -->
      <ng-container matColumnDef="itemType">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let share">
          <mat-chip [class.file-chip]="share.itemType === 'file'" 
                    [class.folder-chip]="share.itemType === 'folder'">
            {{ share.itemType | titlecase }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Share URL Column -->
      <ng-container matColumnDef="shareUrl">
        <th mat-header-cell *matHeaderCellDef>Share Link</th>
        <td mat-cell *matCellDef="let share">
          <div class="link-cell">
            <span class="link-text">{{ share.linkToken.substring(0, 20) }}...</span>
            <button mat-icon-button (click)="copyLink(share.shareUrl)" matTooltip="Copy link">
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <!-- Expires At Column -->
      <ng-container matColumnDef="expiresAt">
        <th mat-header-cell *matHeaderCellDef>Expires</th>
        <td mat-cell *matCellDef="let share">
          <div class="expires-cell" [class.expired]="isExpired(share.expiresAt)">
            <mat-icon>{{ isExpired(share.expiresAt) ? 'error' : 'schedule' }}</mat-icon>
            <span>{{ share.expiresAt | date:'short' }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Created At Column -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Created</th>
        <td mat-cell *matCellDef="let share">
          {{ share.createdAt | date:'short' }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let share">
          <button mat-icon-button 
                  color="warn" 
                  (click)="revokeShare(share)"
                  matTooltip="Revoke share">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <!-- Mobile Card View (for small screens) -->
  <div *ngIf="!isLoading && shares.length > 0" class="mobile-cards">
    <mat-card *ngFor="let share of shares" class="share-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>{{ getTypeIcon(share.itemType) }}</mat-icon>
        <mat-card-title>{{ share.itemName }}</mat-card-title>
        <mat-card-subtitle>
          <mat-chip [class.file-chip]="share.itemType === 'file'" 
                    [class.folder-chip]="share.itemType === 'folder'">
            {{ share.itemType | titlecase }}
          </mat-chip>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="card-row">
          <mat-icon>link</mat-icon>
          <span class="link-text">{{ share.linkToken.substring(0, 25) }}...</span>
          <button mat-icon-button (click)="copyLink(share.shareUrl)">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>

        <div class="card-row" [class.expired]="isExpired(share.expiresAt)">
          <mat-icon>{{ isExpired(share.expiresAt) ? 'error' : 'schedule' }}</mat-icon>
          <span>Expires: {{ share.expiresAt | date:'short' }}</span>
        </div>

        <div class="card-row">
          <mat-icon>access_time</mat-icon>
          <span>Created: {{ share.createdAt | date:'short' }}</span>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-raised-button color="warn" (click)="revokeShare(share)">
          <mat-icon>delete</mat-icon>
          Revoke
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>